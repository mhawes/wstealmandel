% ------------------------------------------------------------------------------
% includes preamble stuff
\include{pre}

% ------------------------------------------------------------------------------
%title
\title{
\huge A Work-Stealing Scheduling Technique Applied to Computing the Mandelbrot Set.
}

\author{
  Martin J Hawes\\
  \\
  Department of Computer Science, \\
  The University of Hertfordshire \\ 
  \\
  \textit{hawesmartin@googlemail.com}\\
}

% ------------------------------------------------------------------------------
% - Document starts here
% ------------------------------------------------------------------------------

\begin{document}
\maketitle
\date{}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\pagenumbering{Roman}
\section*{Abstract}


% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section*{Acknowledgements}


% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\clearpage
\pagenumbering{arabic}
\setcounter{page}{1}
\tableofcontents

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\chapter{Introduction}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\chapter{Problem Background}
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% NO-CITES
%\nocite{jmcguin}
%-------------

\section{Dynamic Scheduling Techniques for Multi-Threaded Computations}
This section briefly describes the problems associated with scheduling Multi-Threaded Algorithms at run-time and
the major paradigms that have surfaced.

% explain problems here...... is this better off in the intro??
In order to efficiently utilise a parallel computer architecture it is desirable to minimise
the amount of time a processor spends idle or performing other logistical tasks, I.e not doing work. 
When a computation's \textit{concurrent sub-tasks} or \textit{threads} incur a regular cost in processor
time, each processor can simply have the same amount of work assigned to them. When the computation has
more irregular or dynamically growing sub-tasks a problem arises resulting in 
processors becoming idle while others still remain working. The solution to this problem is referred to as
\textit{load balancing} and can be described as a form of dynamic scheduling that ensures each processor 
spends approximately the same amount of time working. This means processors generally spend
less time idle, however have to deal with scheduling overheads as a trade-off.

When considering the scheduling of multi-threaded computations, two major load balancing techniques have been used.
These are \textit{work-sharing} and \textit{work-stealing}.

\begin{itemize}
\item \textbf{Work-Sharing:} A processor which creates new work attempts to migrate it to another underutilised processor at creation time. 
\item \textbf{Work-Stealing:} A processor which is starved of work attempts to ``steal'' work from other processors. 
\end{itemize}

Both techniques intend to promote balanced work-load across all processors, however in Work-Stealing
the frequency of work migrations is lower. When all processors have a 
high work-load and no need to ``steal" this becomes useful because threads need not get 
migrated at all. With work-sharing work migration occurs each time new work is created \cite[p.~2]{blumleis}.
This also suggests that work-stealing promotes better locality and grouping of sub-tasks, as spawned work 
stays with the same processor until stolen.


% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{The Work-Stealing Technique - Described in Depth}

As described above, Work-Stealing is a load balancing technique which allows work starved processors to acquire scheduled work from other processors. 

Each processor has a queue of assigned tasks to complete. In general, a processor acquires its work from here.
However, once this queue is exhausted, the processor becomes a \textit{thief} and chooses a \textit{victim} to steal from. 
The method used to choose a victim is implementation specific, for instance some implementations adopt a random scheme \cite{blumleis , jliff, narora}.
If the processor successfully steals work it relinquishes its thief state and returns to doing work.
If the steal attempt is unsuccessful, for instance when the victim's work queue is empty or blocked, the processor tries again
until it is determined that there is no work remaining in the entire network. 

Figure~\ref{fig:stealoperation} illustrates the result of a successful steal operation in which work-starved processor \textit{p1} transfers a piece
of work from \textit{p0's} queue to its own. %do more here.

\begin{figure}[h]
\centering
\begin{subfigure}[b]{0.4\textwidth}
  \centering    
%  \includegraphics[width=\textwidth]{stealreq}
  \include{./imgs/stealreq}
  \caption{
    \tiny A steal request by the thief processor \textit{p1} on victim \textit{p0}.
  }
  \label{fig:stealreq}
\end{subfigure}
~~~~~~ %spacer
\begin{subfigure}[b]{0.4\textwidth}
  \centering
%  \includegraphics[width=\textwidth]{stealafter}
  \include{./imgs/stealafter}
  \caption{
    \tiny The attempt was successful and the work was re-assigned to \textit{p1}.
  }
  \label{fig:stealsuccess}
\end{subfigure}
\caption{
    A successful steal operation between a thief and its victim.
  }
\label{fig:stealoperation}
\end{figure}

Research has been conducted to explore it's application in programming languages \cite{}, 
operating systems \cite{}, and high performance parallel computing \cite{}.

This section explores some schemes used to implement work-stealing in various settings. It is focused on overall design and 
techniques presented in related literature. 

\subsection*{Schemes}
\subsection*{Stealing Policy}
\subsection*{The Work Queue}


% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{The Mandelbrot Set}

%\subsection{Background}
The Mandelbrot set is a set of complex numbers which when plotted produce a spectacular and recognisable shape as illustrated in figure~\ref{fig:mandelimg}.
It is often presented as a colourful and striking image and has been described by some as the most beautiful object in all of mathematics \cite[p.~234]{chaosfract}.
The complex numbers that comprise the set are closely related to \textit{Julia Sets}. 
In-fact the Mandelbrot set can be described as a catalogue of Julia Sets which, when plotted, all points are \textit{connected}, 
forming a \textit{single, unbroken shape} \cite[p.~177]{fractimg}.

The set is named for the mathematician \textit{Benoit Mandelbrot}, who discovered it in 1980 \cite{fracnature , fractimg}. He was a pioneer in the study of 
fractal geometry and also coined the term \textit{fractal}, of which both the Mandelbrot set, and Julia sets are examples of. 

In this section I will give a more detailed explanation of the areas mentioned here. 

\begin{figure}[h]
  \caption{A rendering of The Mandelbrot Set generated using the program ``fraqtive"\cite{fraqtive}.}
  \label{fig:mandelimg}
  \centering
    \includegraphics[width=1\textwidth]{mandelbrot}
\end{figure}

\subsection*{Fractals and Self-Similarity} 
%TODO: this section needs citations all over the shop!
A fractal is a means of describing shapes which are more complex than classical geometric shapes. The leaves of a pine tree or the forks of a 
lightning bolt are obvious examples of real things that fractals allow us to more faithfully describe. 
These \textit{real world fractals} are similar to \textit{mathematical fractals}, 
of which the Mandelbrot set is an example, but differ in that they do not display the property of \textit{Scale Invariance}. 

Fractals have a fractional dimension. % TODO MORE HERE!!!!!
 
A property of fractals (but not all) is \textit{Self-Similarity}, where the shape is comprised of smaller ``copies" of itself. 
This is known as \textit{Exact Self-Similarity} and means that the shape is identical at any scale.
A well-known example of this is the \textit{Triadic Koch Snowflake} which is a fractal constructed using equilateral triangles. 
It is important to note here that The Mandelbrot set does not quite show the same property, it is said to be 
\textit{Quasi Self-Similar}. This means that the shape is approximately similar at all scales, in that the shape is replicated but in a slightly distorted
form with each ``copy".

It turns out there are many rather useful applications for fractals. To name a few; computer game graphics, %FIND MORE EXAMPLES WITH CITATIONS.

\subsection*{Julia Sets}

To understand the basis of the Mandelbrot set it is first necessary to understand it's relation to \textit{Julia Sets}.
The function in equation~\ref{eq:julia1} is iterated infinitely where \(c\) is fixed.
The \textit{filled Julia Set} is comprised of all values of \(z_0\) where the result is bounded and does not tend towards infinity.
The \textit{Julia Set} is comprised of those members of the \textit{filled Julia Set} which lie on the boundary \cite{chaosfract}.
In the interest of keeping this report readable, and because filled Julia Sets are more relevant, filled Julia sets will be 
referred to simply as \textit{Julia Sets}.

% express the set notation for f(x) -> infinity.???? TODO
\begin{equation}\label{eq:julia1}
f(z) = z^2 + c
\end{equation}

With regards to the Mandelbrot Set I am interested in Julia Sets in which the values \(c\) and \(z\) used are expressed as a complex number. 
Figure~\ref{fig:juliaimgs} illustrates some examples of such sets. 

\begin{figure}[h]
\centering
\begin{subfigure}[b]{0.48\textwidth}
  \centering    
  \includegraphics[width=\textwidth]{julia-con}
  \caption{
    \tiny The Julia Set where \(c = -0.1 + 0.649i\)
  }
  \label{fig:juliaimgcon}
\end{subfigure}
~ %spacer
\begin{subfigure}[b]{0.48\textwidth}
  \centering
  \includegraphics[width=\textwidth]{julia-ncon}
  \caption{
    \tiny The Julia Set where \(c = -0.75 + 0.03i\)
  }
  \label{fig:juliaimgncon}
\end{subfigure}
% full caption
\caption{
  Two Julia Sets rendered using the program \textit{fraqtive}\cite{fraqtive}. 
  Figure~\ref{fig:juliaimgcon} is a member of the Mandelbrot set, 
  figure~\ref{fig:juliaimgncon} is not.
}
\label{fig:juliaimgs}
\end{figure}

\subsection*{Computing the Mandelbrot Set}

The set is comprised of those Julia Sets which are \textit{connected}. In order to determine whether a Julia Set possesses this property,
we need only compute the result for \(z_0\). If this tends towards infinity the value \(c\) is not a member of the Mandelbrot Set. If the result
is bounded, then it is a member. This is known as the \textit{critical orbit} and is useful because it means we do not have to compute
the entire Julia Set for each value of \(c\).

So the Mandelbrot set can be computed by iterating all possible values of \(c\) for the function in equation~\ref{eq:julia1} where \(z\) is the \textit{critical
orbit}. Because the set of all possible values of \(c\) is infinite, and computers have a finite amount of resources, this set needs to be approximated. 
This can be done using a raster plane which takes samples of the complex plane at regular intervals. 

% TALK ABOUT VARIOUS ALGORITHMS PRESENTED TODO
Level set method \cite[p.~188]{fractimg} Continuous Potential Method \cite[p.~191]{fractimg}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\chapter{Main Sections}
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Programming Tools}

This section discusses some of the programming tools which are candidates
for use in the implementation.
The tools discussed in this section are all viable options for a Linux platform.

\subsection*{Languages}

\begin{itemize}
\item \textbf{C:} 
\item \textbf{C++:}
\item \textbf{Java:}
\end{itemize}

\subsection*{Concurrent Programming Libraries}
In order to implement Work-Stealing, support for programming threads 
with a suitable level of control is required.

\begin{itemize}
\item \textbf{POSIX Threads (pthreads):} Provides low level manipulation of threads for the C programming language \cite{pthreadover}. 
              It is a library based on IEEE standard 1003.1. Thread programming is achieved through use of a set of functions and data
              structures provided, such as \textit{mutexes}, \textit{semaphores}, \textit{ }. %TODO
             
\item \textbf{Open Multiprocessing (OpenMP):} Provides abstract thread programming interfaces for C, C++, and fortran.
              In general OpenMP only allows coarse grained manipulation of threads through features such as parallel loops %TODO
              \cite{ompvspthr}

\item \textbf{Java Threads:}
\end{itemize}

\subsection*{Graphical Output}
For the purpose of demonstrating that the program correctly generates a raster plane
of the Mandelbrot set, a graphical representation of the plane should be output.

\begin{itemize}
\item \textbf{PPM Output File:} The simplest option is to output to a Portable Pixel Map (PPM) file. It is 
              text-file based and easy to implement but produces rather large files. 
              The process of outputting to a text file is inherently serial in nature,
              so with large image resolutions processing takes a long time.
              There is support for both grey-scale (Portable Grey-scale Map format) and colour images. 
              \cite{ppmspec}
              
\item \textbf{GNU Plot:} A graph plotting package available for multiple operating systems. 
              Supports screen display or file output of both 2d and 3d graphics \cite{gnuplot}.
              There are programming interfaces available for various languages such as C \cite{gnuplotcint}, C++ \cite{gnuplotcppint}, 
              and Java \cite{gnuplotjint}.
              
%\item \textbf{OpenGL}
\end{itemize}
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Design of the Algorithm}

\begin{lstlisting}[label = li:mandelalgo, caption = A sequential algorithm to compute the Mandelbrot Set presented in pseudo code.]
compute_mandelbrot()
    FOR y = 0 TO height - 1 DO
        c_im := im_min + y * (im_max - im_min)/(height - 1)
        FOR x = 0 TO width - 1 DO
            c_re := re_min + x * (re_max - re_min)/(width - 1)
            plane[x][y] := is_in_set(c_re,c_im,max_iterations)
        END FOR
    END FOR
END

is_in_set(c_re,c_im,y,max_iterations)
    z_re := c_re
    z_im := c_im

    FOR i = 0 TO max_iterations DO
        IF( z_re^2 + z_im^2 > 4) THEN
            RETURN false
        END IF
    END FOR
    RETURN true 
END

\end{lstlisting}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{The Implementation}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{An Algorithm to Compute the Mandelbrot Set}

% talk about the static keyword in C for the array.
% talk about inlining some functions
% talk about 

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\subsection{A Concurrent Algorithm to Compute the Mandelbrot Set}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Features for Demonstration}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Validation and Verification}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\chapter{Discussion and Evaluation}
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Analysis of the Algorithm}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Reflection on Project}
\subsection{Further Work}
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\chapter{Resources}

\nocite{*}

% refs\bibs:
\bibliography{refs}

% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
% ---------------------------------------------------------------------------------------------------------------------------------------------------------------
\chapter{Appendices}

\end{document}
